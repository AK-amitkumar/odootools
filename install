#!/bin/bash

if [ ! -d /etc/odoo ]; then  # Install Odoo (only one time)
    sudo wget -O - https://nightly.odoo.com/odoo.key | sudo apt-key add -
    echo "deb http://nightly.odoo.com/8.0/nightly/deb/ ./" | sudo tee /etc/apt/sources.list.d/odoo.list > /dev/null
    sudo apt-get update
    sudo apt-get -y install odoo
    # Generate a good password
    sudo perl -i -pe 'BEGIN { $pw.=(a..z,A..Z,0..9)[rand 62] for 0..15 } s/; admin_passwd.*$/admin_passwd = $pw/g' /etc/odoo/openerp-server.conf
    sudo wget -O /etc/odoo/odoo.tools https://raw.githubusercontent.com/vertelab/odootools/master/odoo.tools
fi
sudo wget -O /etc/bash.odoo https://raw.githubusercontent.com/vertelab/odootools/master/bash.odoo
# Adds import of bash.odoo as last line of bash.bashrc
sudo perl -i -pe 's/\. \/etc\/bash.odoo//g'  /etc/bash.bashrc
sudo perl -i -pe '$_ .= "\n. /etc/bash.odoo\n" if eof' /etc/bash.bashrc

sudo wget -O /etc/bash_completion.d/odoo https://raw.githubusercontent.com/vertelab/odootools/master/bash_completion.odoo

sudo wget -O /etc/cron.daily/db_backup https://raw.githubusercontent.com/vertelab/odootools/master/db_backup
sudo chmod a+x /etc/cron.daily/db_backup

. /etc/bash.odoo
. /etc/bash_completion
