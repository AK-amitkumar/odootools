#!/bin/bash
function odooutv {
    if [ ! -f /etc/odoo/odoopasswords ]; then
        echo LÃ¶senordsfilen hittades inte!
        echo /etc/odoo/odoopasswords
        exit
    fi
    cat bash.odoo > temp
    cat odooutv|sed s/_MYSQL_PASSWORD_/$(sudo cat /etc/odoo/odoopasswords|grep _MYSQL_PASSWORD_|sed s/_MYSQL_PASSWORD_\ //)/ >> temp
    sudo cp -f temp /etc/bash.odoo
    sudo chown root:root /etc/bash.odoo
    rm -rf temp
    cat /etc/bash.bashrc|grep -v .\ /etc/bash.odoo > temp
    echo . /etc/bash.odoo >> temp
    sudo cp -f temp /etc/bash.bashrc
    rm -rf temp
    echo Done
}

function personlig {
    cat bash.odoo > temp
    cat personlig >> temp
    sudo cp -f temp /etc/bash.odoo
    sudo chown $USER:$USER /etc/bash.odoo
    rm -rf temp
    cat /etc/bash.bashrc|grep -v .\ /etc/bash.odoo > temp
    echo . /etc/bash.odoo >> temp
    sudo cp -f temp /etc/bash.bashrc
    rm -rf temp
    echo Done
}

# Install Odoo (if its not installed already)
if [ ! -d /etc/odoo ]; then
    sudo wget -O - https://nightly.odoo.com/odoo.key | sudo apt-key add -
    echo "deb http://nightly.odoo.com/8.0/nightly/deb/ ./" | sudo tee /etc/apt/sources.list.d/odoo.list > /dev/null
    sudo apt-get update
    sudo apt-get -y install odoo
    sudo grep -v "admin_passwd" /etc/odoo/openerp-server.conf | sudo tee /etc/odoo/openerp-server.conf > /dev/null
    echo "admin_passwd = " `python -c 'import base64, os; print(base64.b64encode(os.urandom(14)))' ` | sudo tee --append /etc/odoo/openerp-server.conf > /dev/null
fi

sudo wget -O /etc/bash.odoo https://raw.githubusercontent.com/vertelab/odootools/master/bash.odoo
sudo grep -v bash.odoo /etc/bash.bashrc | sudo tee /etc/bash.bashrc > /dev/null
echo ". /etc/bash.odoo" | tee --append /etc/bash.bashrc > /dev/null

sudo wget -O /etc/bash_completion.d/odoo https://raw.githubusercontent.com/vertelab/odootools/master/bash_completion.odoo

sudo wget -O /etc/cron.daily/db_backup https://raw.githubusercontent.com/vertelab/odootools/master/db_backup
sudo chmod a+x /etc/cron.daily/db_backup

. /etc/bash.odoo
. /etc/bash_completion
